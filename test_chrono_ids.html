<!DOCTYPE html>
<html>
<head>
    <title>Test Chronological IDs</title>
</head>
<body>
    <h1>WebSocket Test for Chronological IDs</h1>
    <div id="status">Connecting...</div>
    <div id="messages"></div>
    
    <script>
        const ws = new WebSocket('ws://localhost:8005/ws/file-updates');
        const messagesDiv = document.getElementById('messages');
        const statusDiv = document.getElementById('status');
        
        ws.onopen = function() {
            statusDiv.textContent = 'Connected to WebSocket';
            console.log('[WebSocket] Connected');
        };
        
        ws.onmessage = function(event) {
            if (event.data === 'pong') {
                return;
            }
            
            try {
                const data = JSON.parse(event.data);
                console.log('[WebSocket] Received:', data);
                
                const message = document.createElement('div');
                message.style.marginTop = '10px';
                message.style.padding = '10px';
                message.style.border = '1px solid #ccc';
                message.innerHTML = `
                    <strong>Action:</strong> ${data.action}<br>
                    <strong>File:</strong> ${data.file.name}<br>
                    <strong>Path:</strong> ${data.file.path}<br>
                    <strong>Modified:</strong> ${new Date(data.file.modified * 1000).toLocaleString()}
                `;
                messagesDiv.appendChild(message);
                
                // Log the message for debugging
                console.log('File update received:', {
                    action: data.action,
                    file: data.file.name,
                    path: data.file.path
                });
            } catch (e) {
                console.error('[WebSocket] Error parsing message:', e);
            }
        };
        
        ws.onclose = function() {
            statusDiv.textContent = 'Disconnected from WebSocket';
            console.log('[WebSocket] Disconnected');
        };
        
        ws.onerror = function(error) {
            statusDiv.textContent = 'WebSocket Error';
            console.error('[WebSocket] Error:', error);
        };
        
        // Keep connection alive
        setInterval(() => {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send('ping');
            }
        }, 30000);
    </script>
</body>
</html>